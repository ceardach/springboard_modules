<?php

/**
 * @file
 * Secure prepopulate tests for anonymous users.
 */

include_once(dirname(__FILE__) . '/secure_prepopulate.test');

class AnonymousUserTestCase extends SecurePrepopulateTestCase {
  
  public static function getInfo() {
    return array(
      'name' => 'Secure pre-populate anonymous user tests',
      'description' => 'Tests secure pre-populate with anonymous users.',
      'group' => 'Springboard',
    );
  }

  /**
   * Test pre-population for an anonymous user
   */
  function testAnonymousPopulate() {
    $node = $this->webformNode();
    $this->drupalGet('node/' . $node->nid, array('query' => array('af' => $this->_encrypted)));
    $this->assertFieldByName('submitted[first_name]', 'Euro');
    $this->assertFieldByName('submitted[last_name]', 'Guy');
    $this->pass(var_export($this->drupalGetContent(), TRUE)); 
  }

  /**
   * Test the decryption of a string
   */
  function testDecrypt() {
    $decrypted = secure_prepopulate_decrypt($this->_encrypted);
    $this->assertEqual($decrypted['first_name'], 'Euro', t('Make sure decrypted first_name field = Euro'));
    $this->assertEqual($decrypted['last_name'], 'Guy', t('Make sure decrypted last_name field = Guy'));
    $this->assertEqual($decrypted['uid'], '29', t('Make sure decrypted uid field = 29'));
  }
}
